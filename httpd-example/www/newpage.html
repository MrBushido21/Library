<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <span id="welcom"></span>
    <br>
    <br>
    <input id="searchName" type="text" placeholder="Пошук за назвою...">
    <button id="findName">Find</button>
    <input id="searchAhutor" type="text" placeholder="Пошук за автором...">
    <button id="findAhutor">Find</button>
    <br>
    <br>
    <div id="searchContainer"></div>
    <br>
    <br>
    <div id="container"></div>



    <!-- ==================================================== -->
    <script>
        let findName = document.getElementById("findName")
        let searchName = document.getElementById("searchName")
        let findAhutor = document.getElementById("findAhutor")
        let searchAhutor = document.getElementById("searchAhutor")

        let container = document.getElementById("container")
        let searchContainer = document.getElementById("searchContainer")


        async function search (path, searchValue) {
            const bookName = searchValue.value

            try {
                const response = await
                    fetch(path, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ bookName: bookName})
                    })

                if (response.ok) {
                    let data = await response.json(); 
                    data.books.map(name => {
                    const div = document.createElement("div")
                    const btn = document.createElement("button")
                    div.innerText = name
                    btn.innerText = "Take"
                    searchContainer.appendChild(div).appendChild(btn)
                })

                } else {
                    console.error(error);
                }
            } catch (error) {
                console.error(error);
            }
        }



        window.onload = async function () {
            let user = localStorage.getItem("username")
            document.getElementById("welcom").textContent = `Hi ${user}`

            try {
                const response = await
                    fetch('/getbooks')
                let data = await response.json();
                data.books.map(name => {
                    const div = document.createElement("div")
                    const btn = document.createElement("button")
                    div.innerText = name
                    btn.innerText = "Take"
                    container.appendChild(div).appendChild(btn)
                })

            } catch (error) {
                console.log(error);
            }
        }

        findName.addEventListener("click", async () => search("/searchName", searchName))
        findAhutor.addEventListener("click", async () => search("/searchAuthor", searchAhutor))
    </script>
</body>

</html>